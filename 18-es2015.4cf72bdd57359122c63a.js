(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{gMET:function(e,t,n){"use strict";n.r(t),n.d(t,"UserManagementPageModule",(function(){return C}));var o=n("ofXK"),i=n("3Pt+"),s=n("TEn/"),r=n("tyNb"),a=n("mrSG");class l{constructor(){this.limit=0,this.totalUser=0,this.totalPage=0,this.offset=0,this.searchBy="name",this.orderBy="name",this.isAscending=!0,this.name="",this.email=""}}var c=n("fXoL"),b=n("/zMi");let d=(()=>{class e{constructor(e,t,n){this.modalController=e,this.userManagementService=t,this.toastController=n,this.user={_id:"",name:"",email:"",role:""}}ngOnInit(){}dismissModal(){this.modalController.dismiss()}createAcc(){this.userManagementService.createUser(this.user).subscribe(()=>Object(a.a)(this,void 0,void 0,(function*(){this.dismissModal(),(yield this.toastController.create({header:`Create ${this.user.name}'s account success!`,color:"success",duration:2e3})).present()})),()=>Object(a.a)(this,void 0,void 0,(function*(){(yield this.toastController.create({header:`Fail to create ${this.user.name}'s account!`,color:"danger",duration:2e3})).present()})))}}return e.\u0275fac=function(t){return new(t||e)(c.Mb(s.R),c.Mb(b.a),c.Mb(s.Y))},e.\u0275cmp=c.Gb({type:e,selectors:[["app-create-user"]],decls:37,vars:3,consts:[["color","tertiary"],["slot","end"],["shape","round","fill","clear",3,"click"],["name","close"],["name","person","slot","start"],["position","floating"],["type","text",3,"ngModel","ngModelChange"],["name","mail","slot","start"],[3,"ngModel","ngModelChange"],["name","ribbon","slot","start"],["interface","popover",3,"ngModel","ngModelChange"],["value","admin"],["value","data manager"],["value","senior data manager"],["lines","none",1,"ion-margin-top"],["slot","end","size","default",3,"click"],["name","save","slot","start"]],template:function(e,t){1&e&&(c.Rb(0,"ion-header"),c.Rb(1,"ion-toolbar",0),c.Rb(2,"ion-title"),c.Ac(3,"Create new account"),c.Qb(),c.Rb(4,"ion-buttons",1),c.Rb(5,"ion-button",2),c.Zb("click",(function(){return t.dismissModal()})),c.Nb(6,"ion-icon",3),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Rb(7,"ion-content"),c.Rb(8,"ion-grid"),c.Rb(9,"ion-row"),c.Rb(10,"ion-col"),c.Rb(11,"ion-item"),c.Nb(12,"ion-icon",4),c.Rb(13,"ion-label",5),c.Ac(14,"Name"),c.Qb(),c.Rb(15,"ion-input",6),c.Zb("ngModelChange",(function(e){return t.user.name=e})),c.Qb(),c.Qb(),c.Rb(16,"ion-item"),c.Nb(17,"ion-icon",7),c.Rb(18,"ion-label",5),c.Ac(19,"Email"),c.Qb(),c.Rb(20,"ion-input",8),c.Zb("ngModelChange",(function(e){return t.user.email=e})),c.Qb(),c.Qb(),c.Rb(21,"ion-item"),c.Nb(22,"ion-icon",9),c.Rb(23,"ion-label"),c.Ac(24,"Role"),c.Qb(),c.Rb(25,"ion-select",10),c.Zb("ngModelChange",(function(e){return t.user.role=e})),c.Rb(26,"ion-select-option",11),c.Ac(27,"Admin"),c.Qb(),c.Rb(28,"ion-select-option",12),c.Ac(29,"Data Manager"),c.Qb(),c.Rb(30,"ion-select-option",13),c.Ac(31,"Senior Data Manager"),c.Qb(),c.Qb(),c.Qb(),c.Rb(32,"ion-item",14),c.Rb(33,"ion-button",15),c.Zb("click",(function(){return t.createAcc()})),c.Nb(34,"ion-icon",16),c.Rb(35,"ion-label"),c.Ac(36,"Create"),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Qb()),2&e&&(c.Ab(15),c.ic("ngModel",t.user.name),c.Ab(5),c.ic("ngModel",t.user.email),c.Ab(5),c.ic("ngModel",t.user.role))},directives:[s.q,s.N,s.M,s.f,s.e,s.r,s.n,s.p,s.C,s.m,s.t,s.u,s.s,s.X,i.e,i.h,s.E,s.W,s.F],styles:[""]}),e})();var u=n("KJTt"),h=n("2MiI"),g=n("lDzL"),m=n("LmEr");function p(e,t){if(1&e){const e=c.Sb();c.Rb(0,"ion-item",20),c.Rb(1,"ion-text"),c.Ac(2),c.Qb(),c.Rb(3,"ion-buttons",5),c.Rb(4,"ion-button",21),c.Zb("click",(function(){c.rc(e);const n=t.$implicit;return c.bc().deleteUser(n)})),c.Nb(5,"ion-icon",22),c.Rb(6,"ion-label"),c.Ac(7,"Delete"),c.Qb(),c.Qb(),c.Qb(),c.Qb()}if(2&e){const e=t.$implicit;c.Ab(2),c.Bc(e.name)}}const f=function(){return{name:"Name"}},R=function(){return{name:"Email"}},Q=function(){return{name:"Role",sortable:!1}},M=function(e,t,n){return[e,t,n]},v=[{path:"",component:(()=>{class e{constructor(e,t,n,o,i,s){this.pagePositionService=e,this.userManagementService=t,this.modalController=n,this.alertController=o,this.toastController=i,this.loadingController=s,this.pageAtTop=!0,this.page=new l,this.rows=new Array,this.selected=[],this.searchText="",this.page.limit=5}ngOnInit(){this.innerWidth=window.innerWidth,this.setPage({offset:0})}onResize(e){this.innerWidth=window.innerWidth}onScroll(e){this.pageAtTop=this.pagePositionService.isPageAtTop(e)}setPage(e){this.presentLoading(),this.page.offset=e.offset,this.userManagementService.getUserList(this.page).subscribe(e=>{this.stopLoading(),this.page.offset=e.offset,this.page.totalUser=e.totalUser,this.page.totalPage=e.totalPage,this.rows=e.user.map(e=>({_id:e._id,name:e.name,email:e.email,role:e.roles.length>0?e.roles[0].role:"-"}))},()=>{this.stopLoading()})}search(){this.presentLoading(),this.page.offset=0,"name"===this.page.searchBy?(this.page.name=this.searchText,this.page.email=""):"email"===this.page.searchBy&&(this.page.name="",this.page.email=this.searchText),this.userManagementService.getUserList(this.page).subscribe(e=>{this.stopLoading(),this.page.offset=e.offset,this.page.totalUser=e.totalUser,this.page.totalPage=e.totalPage,this.rows=e.user.map(e=>({_id:e._id,name:e.name,email:e.email,role:e.roles.length>0?e.roles[0].role:"-"}))},()=>{this.stopLoading()})}presentLoading(){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.loadingController.create({cssClass:"my-custom-class",message:"Searching users..."});yield e.present()}))}stopLoading(){return Object(a.a)(this,void 0,void 0,(function*(){this.loadingController.dismiss()}))}onSort(e){this.page.orderBy=e.column.name.toLowerCase(),this.page.isAscending="asc"===e.newValue,this.userManagementService.getUserList(this.page).subscribe(e=>{this.page.offset=e.offset,this.page.totalUser=e.totalUser,this.page.totalPage=e.totalPage,this.rows=e.user.map(e=>({_id:e._id,name:e.name,email:e.email,role:e.roles.length>0?e.roles[0].role:"-"}))})}onSelect({}){}openCreateUserModal(){return Object(a.a)(this,void 0,void 0,(function*(){const e=yield this.modalController.create({cssClass:"custom-lg-modal",component:d});yield e.present(),yield e.onWillDismiss().then(()=>{this.ngOnInit()})}))}deleteUser(e){return Object(a.a)(this,void 0,void 0,(function*(){const t=yield this.alertController.create({cssClass:"my-custom-class",header:`Permenantly delete ${e.name}'s account`,message:"Are you sure you want to delete this account? This action cannot be undone.",buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",handler:()=>{this.userManagementService.deleteUser(e).subscribe(()=>Object(a.a)(this,void 0,void 0,(function*(){(yield this.toastController.create({header:`Edit ${e.name}'s account success!`,color:"success",duration:2e3})).present(),this.ngOnInit()})),()=>Object(a.a)(this,void 0,void 0,(function*(){(yield this.toastController.create({header:`Fail to edit ${e.name}'s account!`,color:"danger",duration:2e3})).present(),this.ngOnInit()})))}}]});yield t.present()}))}}return e.\u0275fac=function(t){return new(t||e)(c.Mb(u.a),c.Mb(b.a),c.Mb(s.R),c.Mb(s.a),c.Mb(s.Y),c.Mb(s.Q))},e.\u0275cmp=c.Gb({type:e,selectors:[["app-user-management"]],hostBindings:function(e,t){1&e&&c.Zb("resize",(function(e){return t.onResize(e)}),!1,c.qc)},decls:42,vars:27,consts:[[3,"pageAtTop"],[3,"fullscreen","scrollEvents","ionScroll"],["size","0","size-md","1"],["size","12","size-md","10"],["lines","none"],["slot","end"],["color","primary","fill","solid",3,"click"],["name","person-add","slot","start"],["size","9","size-md","5"],["showCancelButton","never","animated","","placeholder","Enter your search",3,"ngModel","keyup.enter","ngModelChange"],["size","1","size-md","1"],["color","primary","fill","solid",2,"margin-top","10px",3,"click"],["name","search-outline"],["size","12","size-md","4"],["interface","popover",3,"ngModel","ngModelChange"],["value","name"],["value","email"],["lines","none","color","light",4,"ngFor","ngForOf"],["rowHeight","auto",1,"material",2,"margin-bottom","70vh",3,"rows","columns","columnMode","headerHeight","footerHeight","externalPaging","count","offset","limit","scrollbarH","selected","selectionType","externalSorting","page","select","sort"],[3,"innerWidth"],["lines","none","color","light"],["color","danger","fill","solid",3,"click"],["name","trash","slot","start"]],template:function(e,t){1&e&&(c.Rb(0,"ion-header"),c.Nb(1,"app-header",0),c.Qb(),c.Rb(2,"ion-content",1),c.Zb("ionScroll",(function(e){return t.onScroll(e)})),c.Rb(3,"ion-grid"),c.Rb(4,"ion-row"),c.Nb(5,"ion-col",2),c.Rb(6,"ion-col",3),c.Rb(7,"ion-item",4),c.Rb(8,"ion-buttons",5),c.Rb(9,"ion-button",6),c.Zb("click",(function(){return t.openCreateUserModal()})),c.Nb(10,"ion-icon",7),c.Rb(11,"ion-label"),c.Ac(12,"Add User"),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Nb(13,"ion-col",2),c.Qb(),c.Rb(14,"ion-row"),c.Nb(15,"ion-col",2),c.Rb(16,"ion-col",8),c.Rb(17,"ion-searchbar",9),c.Zb("keyup.enter",(function(){return t.search()}))("ngModelChange",(function(e){return t.searchText=e})),c.Qb(),c.Qb(),c.Rb(18,"ion-col",10),c.Rb(19,"ion-button",11),c.Zb("click",(function(){return t.search()})),c.Nb(20,"ion-icon",12),c.Qb(),c.Qb(),c.Rb(21,"ion-col",13),c.Rb(22,"ion-item"),c.Rb(23,"ion-label"),c.Ac(24,"Search by"),c.Qb(),c.Rb(25,"ion-select",14),c.Zb("ngModelChange",(function(e){return t.page.searchBy=e})),c.Rb(26,"ion-select-option",15),c.Ac(27,"Name"),c.Qb(),c.Rb(28,"ion-select-option",16),c.Ac(29,"Email"),c.Qb(),c.Qb(),c.Qb(),c.Qb(),c.Nb(30,"ion-col",2),c.Qb(),c.Rb(31,"ion-row"),c.Nb(32,"ion-col",2),c.Rb(33,"ion-col",3),c.yc(34,p,8,1,"ion-item",17),c.Qb(),c.Nb(35,"ion-col",2),c.Qb(),c.Rb(36,"ion-row"),c.Nb(37,"ion-col",2),c.Rb(38,"ion-col",3),c.Rb(39,"ngx-datatable",18),c.Zb("page",(function(e){return t.setPage(e)}))("select",(function(e){return t.onSelect(e)}))("sort",(function(e){return t.onSort(e)})),c.Qb(),c.Qb(),c.Nb(40,"ion-col",2),c.Qb(),c.Qb(),c.Nb(41,"app-footer",19),c.Qb()),2&e&&(c.Ab(1),c.ic("pageAtTop",t.pageAtTop),c.Ab(1),c.ic("fullscreen",!0)("scrollEvents",!0),c.Ab(15),c.ic("ngModel",t.searchText),c.Ab(8),c.ic("ngModel",t.page.searchBy),c.Ab(9),c.ic("ngForOf",t.selected),c.Ab(5),c.ic("rows",t.rows)("columns",c.mc(23,M,c.kc(20,f),c.kc(21,R),c.kc(22,Q)))("columnMode","force")("headerHeight",50)("footerHeight",50)("externalPaging",!0)("count",t.page.totalUser)("offset",t.page.offset)("limit",t.page.limit)("scrollbarH",!0)("selected",t.selected)("selectionType","single")("externalSorting",!0),c.Ab(2),c.ic("innerWidth",t.innerWidth))},directives:[s.q,h.a,s.n,s.p,s.C,s.m,s.t,s.f,s.e,s.r,s.u,s.D,s.X,i.e,i.h,s.E,s.W,s.F,o.k,g.c,m.a,s.K],styles:[""]}),e})()}];let y=(()=>{class e{}return e.\u0275mod=c.Kb({type:e}),e.\u0275inj=c.Jb({factory:function(t){return new(t||e)},imports:[[r.i.forChild(v)],r.i]}),e})();var A=n("iWjc");let C=(()=>{class e{}return e.\u0275mod=c.Kb({type:e}),e.\u0275inj=c.Jb({factory:function(t){return new(t||e)},imports:[[o.c,i.a,s.O,y,g.d,A.a]]}),e})()}}]);